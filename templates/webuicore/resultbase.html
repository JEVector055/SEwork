<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Player with Comments</title>
    {% block style %}
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
        }
        .sidebar {
            width: 200px;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
            background-color: #f4f4f4;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
        }
        .sidebar h3 {
            margin-top: 0;
        }
        .sidebar ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        .sidebar li {
            margin: 10px 0;
        }
        .sidebar a {
            text-decoration: none;
            color: #333;
        }
        .content {
            margin-left: 220px;
            padding: 20px;
            display: flex;
            flex-direction: column; /* 使子元素垂直排列 */
        }
        .source-video-container {
            width: 50%;
            padding: 10px;
            box-sizing: border-box;
            text-align: center;
            margin-bottom: 10px; /* 与下方元素的间距 */
            position: relative; /* 或者使用 absolute */
            top: -50px; /* 向上移动 50 像素 */
        }
        .source-video-container video {
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .videoclip-comment-pair {
            display: flex;
            flex-direction: row;
            padding: 10px;
            box-sizing: border-box;
        }
        .videoclip-container {
            width: 50%;
            padding-right: 10px;
        }
        .comment-process-button {
            width: 50%;
            padding-left: 10px;
            margin-top: 20px;
            margin-bottom: 4px;
            cursor: pointer;
            text-align: center;
        }
        .comment-container {
            width: 50%;
            padding-left: 10px;
            border-left: 1px solid #ccc;
        }
        video {
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        h2 {
            font-size: 1.2em;
        }
        p {
            font-size: 0.9em;
            color: #666;
        }
        .video-and-button-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }
        .anomaly-detection-button {
            width: 80%;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
        }
        .videoclips-container {
            margin-top: 20px; /* 上边距 */
            padding: 40px; /* 内边距 */
            /*border-top: 1px solid #ccc; /* 上边框 */
            background-color: rgb(0, 255, 255); /* 浅灰色背景
        }

        .videoclip-item {
            margin-bottom: 10px;
            cursor: pointer;
        }
    </style>
    {% endblock style %}
</head>
<body>
    <div class="sidebar">
        <h3>视频管理列表</h3>
        <ul id="file-list">
            <!-- 文件列表将通过JavaScript动态生成 -->
        </ul>
    </div>
    <div class="content">
        <!-- 网页头与标题：这里补充UI -->
        {% block title %}
        {% endblock title %}

        <!-- 视频播放器和按钮容器 -->
        <div class="video-and-button-container">
            <!-- 源视频 -->
            <div class="source-video-container">
                <h2>{{svideo}}</h2>
                <video id="source-video" controls>
                    <source src="{{ svideo.SourceVideo_file.url }}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
            <!-- 异常检测按钮 -->
            <button class="anomaly-detection-button">异常检测</button>
        </div>

        <!-- 隔断：这里补充UI -->
        {% block spacebar %}
        {% endblock spacebar %}

        <!-- 下面的视频和注释横向对齐 -->
        {% for videoclip in vclips_comments %}
        <div class="videoclip-comment-pair">
            <div class="videoclip-container">
                <h2>视频片段{{ videoclip.title }}</h2>
                <video id="{{ forloop.counter }}" controls>
                    <source src="{{ videoclip.VideoClip_file.url }}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
            {% if videoclip.comment.text %}
            <div class="comment-container">
                <h2>对视频片段{{videoclip.title}}的文字描述</h2>
                <p>{{ videoclip.comment.text }}</p>
            </div>
            {% else %}
            <div class="comment-process-button">
                <!-- 生成文字描述按钮：补充UI -->
                {% block cpbutton %}
                <button id="{{ forloop.counter }}">生成视频片段{{ videoclip.title }}的文字描述</button>
                {% endblock cpbutton %}
            </div>
            {% endif %}
        </div>
        {% empty %}
            <!-- 空结果提示：未上传视频/需要等待处理 （补充UI） -->
            {% block tipofempty%}
            {% endblock tipofempty %}
        {% endfor %}

        <!-- 视频片段列表 -->
        <div class="videoclips-container">
            <h3>视频片段列表</h3>
            <ul id="videoclips-list">
                <!-- 视频片段列表将通过JavaScript动态生成 -->
            </ul>
        </div>

        <!-- 底部：这里补充UI -->
        {% block bottom %}
        {% endblock bottom %}
    </div>
</body>
<script>
    // 当文档内容加载完成后，执行指定函数
    document.addEventListener('DOMContentLoaded', function() {
        // 发送GET请求获取文件列表
        fetch('/get-files')
            .then(response => response.json()) // 将响应转换为JSON
            .then(data => {
                // 获取文件列表元素
                const fileList = document.getElementById('file-list');
                // 遍历文件数据，创建并添加文件链接到文件列表
                data.forEach(file => {
                    const li = document.createElement('li');
                    const a = document.createElement('a');
                    a.href = '#';
                    a.textContent = file;
                    a.onclick = function(){
                        const videoPlayer = document.getElementById('source-video');
                        videoPlayer.src = `/media/SourceVideos/${file}`;
                        videoPlayer.load();  // 重新加载视频
                        videoPlayer.play();  // 播放视频
                    }
                    li.appendChild(a);
                    fileList.appendChild(li);
                });

                // 发送GET请求获取视频片段列表
                fetch('/get-videoclips')
                    .then(response => response.json())
                    .then(videoclips => {
                        const videoclipsList = document.getElementById('videoclips-list');
                        videoclips.forEach(videoclip => {
                            const li = document.createElement('li');
                            li.className = 'videoclip-item';
                            li.textContent = videoclip.title;
                            li.onclick = function() {
                                const videoPlayer = document.getElementById('source-video');
                                videoPlayer.src = `/media/Videoclips/${videoclip.file}`;
                                videoPlayer.load();
                                videoPlayer.play();
                            }
                            videoclipsList.appendChild(li);
                        });
                    })
                    .catch(error => console.error('Error fetching videoclips:', error));
            })
            .catch(error => console.error('Error fetching files:', error)); // 捕获并打印错误
    });

    // 为具有ID的按钮添加点击事件监听器
    $('button[id]').on('click', function() {
        // 获取被点击按钮的ID
        const buttonId = this.id;
        // 通过POST请求发送按钮ID到服务器
        $.post('/execute-command/', { button_id: buttonId });
    });

    // 添加异常检测按钮的点击事件
    $('.anomaly-detection-button').on('click', function() {
        // 弹出警告框提示按钮被点击
        alert('异常检测按钮被点击');
        // 这里可以添加更多的逻辑，例如发送请求等
    });
</script>

</html>
